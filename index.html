<!-- BQ-WEB-268CreditCardPayment.html -->
<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" media="screen" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<style>
	@font-face {
		font-family: 'Mundial';
		src: url('/fonts/MundialLight.otf');
		font-weight: normal;
		font-style: normal;
	}

	@font-face {
		font-family: 'Mundial';
		src: url('/fonts/MundialDemibold.otf');
		font-weight: 600;
		font-style: normal;
	}

	body{
		background-color:inherit;
		font-family: sans-serif;
		font-weight: 400;
	}

	::placeholder{
		font-size: 14px;
		color: rgba(29,31,33,0.5);
	}

	::-ms-input-placeholder {
		color: rgba(29,31,33,0.5);
	}

	::-moz-placeholder {
		color: rgba(29,31,33,0.5);
	}

	#payment_info .btn-primary {
		background-color: rgb(228, 85, 86);
		color: white;
		width: 100%;
		max-width: 400px;
		font-weight: 500;
		padding: 2px;
		align-self: center;
		border-radius: 0;
		font-size: 18px;
	}

	#payment_info .btn-primary:hover,
	#payment_info .btn-primary:active,
	#payment_info .btn-primary:focus {
		background-color: #be3c3c;
	}

	.container {
		max-width: 100%;
		font-size:16px;
		padding-left: 0;
		padding-right: 0;
	}

	.form-control {
		font-size:16px;
		margin-right: .5em;
		margin-top: .3em;
	}

	.required-label:after {
		content:"*";
		color: #dc3545;
		margin-left: 2px;
	}

	#errorList {
		padding-left: 20px;
	}

	#errorList li {
		font-weight: 700;
	}

	label {
		margin-bottom: 0;
	}

	.form-control {
		border-radius:0;
	}

	#payment_info select {
		padding-right: 50px;
		position:relative;
		background-position: center right 20px;
	}

	.loading_div,
	.success-wrapper {
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.error.invalid-feedback {
		font-size:11px;
		position:absolute;
		bottom:0;
	}

	.form-group {
		position:relative;
		padding-bottom:18px;
		margin-bottom:5px;
	}

	.form-interface-wrapper {
		min-height: 33px;
	}

	.-never-show {
		display: none !important;
	}
	.-only-in-oep {
		display: none;
	}
	hr {
		margin-top: 20px;
		margin-bottom: 20px;
		border-top-width: 2px;
	}

	/*when in OEP form*/
	.form-in-oep {
		margin-bottom: 0;
	}
	.form-in-oep {
		font-family: "Mundial", Helvetica, Arial, sans-serif;
		font-weight: 400;
	}
	.form-in-oep .-only-in-oep {
		display: block;
	}
	.form-in-oep h2 {
		font-size: 20px;
		font-weight: 600;
		margin-bottom: 12px;
	}
	.form-in-oep h2 .asterisk-required {
		color: #E15573;
	}

	.form-in-oep .form-group {
		position: relative;
		margin-bottom: 0;
		padding-bottom: 18px;
	}
	.form-in-oep .form-group label {
		position: absolute;
		z-index: 2;
		font-size: 12px;
		line-height: 0.75;
		top: 13px;
		left: 13px;
		pointer-events: none;
		right:5px;
	}
	.form-in-oep .form-row>[class*=col-] label {
		left: 18px;
	}
	.form-in-oep .form-control {
		min-height: 65px;
		border-radius: 8px;
		padding-top: 20px;
		padding-bottom: 0;
		font-size: 1.125rem;
	}
	.form-in-oep .form-control {
		margin-top: 0;
	}
	.form-in-oep .error.invalid-feedback {
		bottom: 2px;
	}

	.form-in-oep .form-interface-wrapper {
		min-height: 0;
	}

	body .form-in-oep#payment_info .form-control {
		background-image: none;
	}
	body .form-in-oep#payment_info select.form-control {
		background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTYuMzU0IDUuODU0YS41LjUgMCAwMS0uNzA4IDBsLTUtNWEuNS41IDAgMDEuNzA4LS43MDhMNiA0Ljc5MyAxMC42NDYuMTQ2YS41LjUgMCAwMS43MDguNzA4bC01IDV6IiBmaWxsPSIjMUQxRjIwIi8+PC9zdmc+) no-repeat;
		-webkit-appearance: none;
		-moz-appearance: none;
		appearance: none;
		padding-left: 14px;
		background-size: 13px auto;
		background-position: center right 12px;
	}

	body .form-in-oep#payment_info #validate_payment {
		opacity: 0;
	}
	@media (min-width: 475px) {
		.form-in-oep .col-sm-6 {
			-ms-flex: 0 0 50%;
			flex: 0 0 50%;
			max-width: 50%;
		}
	}
</style>

<FORM ACTION="paymentcapture" id="payment_info" METHOD="POST" novalidate>
	<INPUT TYPE="HIDDEN" NAME="action" VALUE="paymentcapture">
	<INPUT TYPE="HIDDEN" NAME="do" VALUE="payment_validate">
	<INPUT TYPE="HIDDEN" NAME="process" VALUE="1">
	<INPUT TYPE="HIDDEN" NAME="ajax" VALUE="1">
	<INPUT TYPE="HIDDEN" NAME="token" VALUE="%TOKEN%">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<div class="container">
		<div class="sm mb-3">
			<span class="text-danger" id="error_message"></span>
		</div>

		<h2 class="-only-in-oep">
			<span class="js-label js-label-en">Billing information</span>
			<span class="js-label js-label-es">InformaciÃ³n de facturaciÃ³n</span>
			<span class="asterisk-required">*</span>
		</h2>

		<div class="form-group">
			<label for="ccNumber" class="required-label">
				<span class="js-label js-label-en">Credit Card Number</span>
				<span class="js-label js-label-es">NÃºmero de tarjeta de crÃ©dito</span>
			</label>

			<input type="text" id="ccNumber" name="ccNumber" class="form-control" maxlength="16" inputmode="numeric"
				   placeholder="Credit Card Number" value='%ccNumber%' required>
		</div>

		<div class="form-row">
			<div class="form-group col-sm-6 d-flex flex-column form-group justify-content-end">
				<label for="ccName" class="required-label">
					<span class="js-label js-label-en">Name exactly as it appears on your credit card</span>
					<span class="js-label js-label-es">Nombre exactamente como aparece en su tarjeta de crÃ©dito.</span>
				</label>

				<input type="text" id="ccName" name="ccName" class="form-control" placeholder="Name on Credit Card" value="%ccName%" required>
			</div>

			<div class="form-group col-sm-6 d-flex flex-column form-group justify-content-end">
				<label for="ccType" class="required-label">
					<span class="js-label js-label-en">Credit Card Type</span>
					<span class="js-label js-label-es">Tipo de tarjeta de crÃ©dito</span>
				</label>

				<select id="ccType" name="ccType" class="form-control" required>
					<TMPL_LOOP CC_LOOP><option VALUE="%TYPE%" %SELECTED%>%NAME%</option></TMPL_LOOP>
				</select>
			</div>
		</div>

		<div class="form-row">
			<div class="form-group col-sm-6">
				<label for="ccExpMM" class="required-label">
					<span class="js-label js-label-en">Card Expiration Month</span>
					<span class="js-label js-label-es">Mes de vencimiento de la tarjeta</span>
				</label>

				<select id="ccExpMM" name="ccExpMM" class="form-control sm " placeholder="Exp. Month" required>
					<TMPL_LOOP CC_EXP_MM_LOOP><option value="%MONTH%" %SELECTED%>%MONTH%</TMPL_LOOP CC_EXP_MM_LOOP>
				</select>
			</div>
			<div class="form-group col-sm-6">
				<label for="ccExpYY" class="required-label">
					<span class="js-label js-label-en">Card Expiration Year</span>
					<span class="js-label js-label-es">AÃ±o de vencimiento de la tarjeta</span>
				</label>

				<select name="ccExpYY" id="ccExpYY" class="form-control sm" placeholder="Year" required>
					<TMPL_LOOP CC_EXP_YY_LOOP><option value="%YEAR%" %SELECTED%>%YEAR%</TMPL_LOOP CC_EXP_YY_LOOP>
				</select>
			</div>
		</div>

		<div class="form-group">
			<label for="ccCVC" class="required-label">
				<span class="js-label js-label-en">CC CVV</span>
				<span class="js-label js-label-es">CC CVV</span>
			</label>

			<input type="password" class="form-control" id="ccCVC" name="ccCVC" size="5" minlength="3" maxlength="5" value='%ccCVC%' required>
		</div>

		<TMPL_IF OFFER_AUTOPAY>
			<div class="form-check mb-3">
				<input class="form-check-input" type="checkbox" name="ccForAutopay" id="ccForAutopay" <TMPL_IF ccForAutopay>checked="1"</TMPL_IF>>
				<label class="form-check-label align-content-center" for="ccForAutopay">
					<span class="js-label js-label-en">Save this card</span>
					<span class="js-label js-label-es">Guarde esta tarjeta</span>
				</label>
			</div>
		</TMPL_IF>

		<hr class="-only-in-oep" />

		<h2 class="-only-in-oep">
			<span class="js-label js-label-en">Billing address</span>
			<span class="js-label js-label-es">DirecciÃ³n de Envio</span>
			<span class="asterisk-required">*</span>
		</h2>

		<div class="form-group">
			<label for="ccAddress" class="required-label">
				<span class="js-label js-label-en">Billing Street Address (No P.O. Box)</span>
				<span class="js-label js-label-es">DirecciÃ³n de la calle de cobro</span>
			</label>

			<input type="text" id="ccAddress" name="ccAddress" class="form-control" value="%ccAddress%" required>
		</div>

		<div class="form-row">
			<div class="form-group col-sm-6">
				<label for="ccAddress2">
					<span class="js-label js-label-en">Apartment or Unit Number</span>
					<span class="js-label js-label-es">NÃºmero de Unidad o Apartamento</span>
				</label>
				<input type="text" id="ccAddress2" name="ccAddress2" class="form-control" value="%ccAddress2%">
			</div>

			<div class="form-group col-sm-6">
				<label for="ccCity" class="required-label">
					<span class="js-label js-label-en">City</span>
					<span class="js-label js-label-es">Ciudad</span>
				</label>
				<input type="text" id="ccCity" name="ccCity" class="form-control" value="%ccCity%" required>
			</div>
		</div>

		<div class="form-row">
			<div class="form-group col-sm-6">
				<label for="ccZip" class="required-label">
					<span class="js-label js-label-en">Zip Code</span>
					<span class="js-label js-label-es">CÃ³digo postal</span>
				</label>

				<input type="text" id="ccZip" name="ccZip" size="5" minlength="5" maxlength="5" class="form-control" value="%ccZip%" required>
			</div>

			<div class="form-group col-sm-6">
				<label for="ccStateSelect" class="required-label">
					<span class="js-label js-label-en">State</span>
					<span class="js-label js-label-es">Estado</span>
				</label>

				<input type="hidden" id="ccState" name="ccState" class="form-control" placeholder="State" value="%ccState%">

				<!--				this select is not submitted - it just acts as control for hidden ccState input. When select value is changed ccState value is changed also. And vice versa.-->
				<select id="ccStateSelect" class="form-control sm" required>

				</select>
			</div>
		</div>
	</div>

	<div class="justify-content-center align-content-center d-flex flex-column form-interface-wrapper">
		<button type="submit" id="validate_payment"  class="btn btn-primary">
			<span class="js-label js-label-en">Place Order</span>
			<span class="js-label js-label-es">Realizar pedido</span>
		</button>
		<div class="loading_div" id="loading_div" style="display:none;">
			<img src="/images/ajax-loader-transparent.gif">
			<span class="js-label js-label-en">Validating Payment information...</span>
			<span class="js-label js-label-es">Validando informaciÃ³n de pago...</span>
		</div>
		<div class="form-check success-wrapper">
			<img src="/images/check_medium.png" id="img_ok" class="img-fluid align-content-center">
			<span class="text-success" id="success_info"></span>
		</div>
	</div>
	</div>
</form>

<SCRIPT type="text/javascript" LANGUAGE="JavaScript">
	var isFormInOepFlag = window.location.search.indexOf("bequickform=true") !== -1;

	var wasTryOfSubmittAtLeastOnce = false;

	var form = document.querySelector('#payment_info');

	jQuery('#img_ok').hide();

	if(isFormInOepFlag) {
		jQuery("#payment_info").addClass('form-in-oep');
	}

	jQuery.validator.addMethod("letterswithbasicpunc", function(value, element) {
		return this.optional(element) || /^[a-z-.,()'\"\s]+$/i.test(value);
	}, "Letters or punctuation only please");

	jQuery.validator.addMethod("numberswithbasicpunc", function(value, element) {
		return this.optional(element) || /^[0-9x.,\-()'\"\s]+$/i.test(value);
	}, "Please enter credit card number");

	var validationsTranslations= {
		en: {
			required: "This field is required.",
			remote: "Please fix this field.",
			email: "Please enter a valid email address.",
			url: "Please enter a valid URL.",
			date: "Please enter a valid date.",
			dateISO: "Please enter a valid date ( ISO ).",
			number: "Please enter a valid number.",
			digits: "Please enter only digits.",
			equalTo: "Please enter the same value again.",
			maxlength: $.validator.format("Please enter no more than {0} characters."),
			minlength: $.validator.format("Please enter at least {0} characters."),
			rangelength: $.validator.format("Please enter a value between {0} and {1} characters long."),
			range: $.validator.format("Please enter a value between {0} and {1}."),
			max: $.validator.format("Please enter a value less than or equal to {0}."),
			min: $.validator.format("Please enter a value greater than or equal to {0}."),
			letterswithbasicpunc:"Letters or punctuation only please",
			numberswithbasicpunc: "Please enter credit card number",
			CCExp: "Invalid Expiration Date",
		},
		es: {
			required: "Este campo es obligatorio.",
			remote: "Por favor, rellena este campo.",
			email: "Por favor, escribe una direcciÃ³n de correo vÃ¡lida.",
			url: "Por favor, escribe una URL vÃ¡lida.",
			date: "Por favor, escribe una fecha vÃ¡lida.",
			dateISO: "Por favor, escribe una fecha (ISO) vÃ¡lida.",
			number: "Por favor, escribe un nÃºmero vÃ¡lido.",
			digits: "Por favor, escribe sÃ³lo dÃ­gitos.",
			equalTo: "Por favor, escribe el mismo valor de nuevo.",
			maxlength: $.validator.format( "Por favor, no escribas mÃ¡s de {0} caracteres." ),
			minlength: $.validator.format( "Por favor, no escribas menos de {0} caracteres." ),
			rangelength: $.validator.format( "Por favor, escribe un valor entre {0} y {1} caracteres." ),
			range: $.validator.format( "Por favor, escribe un valor entre {0} y {1}." ),
			max: $.validator.format( "Por favor, escribe un valor menor o igual a {0}." ),
			min: $.validator.format( "Por favor, escribe un valor mayor o igual a {0}." ),
			letterswithbasicpunc:"Solo letras o puntuaciÃ³n por favor",
			numberswithbasicpunc: "Por favor ingrese el nÃºmero de tarjeta de crÃ©dito",
			CCExp: "Fecha de expiracion invÃ¡lida"
		}
	}

	var placeholderTranslations = {
		ccNumber: {
			en:"Credit Card Number",
			es: "NÃºmero de tarjeta de crÃ©dito",
		},
		ccName: {
			en: "Name on Credit Card",
			es: "Su nombre en tarjeta de crÃ©dito",
		},
	}

	function applyLanguage(languageCode){
		try{
			var validationLanguageObject = validationsTranslations[languageCode]

			$('.js-label:not(.js-label-'+languageCode+')').hide();
			$('.js-label-'+languageCode).show();

			Object.keys(placeholderTranslations).forEach(function (fieldName) {
				var newPlaceholderText=placeholderTranslations[fieldName][languageCode];

				$('#'+fieldName).attr("placeholder", newPlaceholderText);
			})

			if(Object.keys(validationLanguageObject).length>0){
				$.extend($.validator.messages, validationLanguageObject);

				if(wasTryOfSubmittAtLeastOnce){
					$(form).valid();
				}
			}

			if(languageCode === 'en') {
				$(".js-empty-option")[0].innerText = 'Select State';
			}
			if(languageCode === 'es') {
				$(".js-empty-option")[0].innerText = 'Seleccione estado';
			}
		} catch (e){
			console.error(e)
		}
	}

	$.validator.addMethod("CCExp", function(value, element, params) {
		var minMonth = new Date().getMonth()+1;
		var minYear = new Date().getFullYear();

		var formMonth = $("#ccExpMM").val();
		var formYear = $("#ccExpYY").val();

		var month = parseInt(formMonth);
		var year = parseInt(formYear);

		if ((year > minYear) || ((year === minYear) && (month >= minMonth))) {
			return true;
		} else {
			return false;
		}
	}, "Invalid Expiration Date");

	window.addEventListener("message", function (e) {
		if(e.data.iframeInited){
			$('#validate_payment').addClass('-never-show');
			$('#error_message').addClass('-never-show');

			sendFormHeightToParent();
		}

		if(e.data.idOfLanguage) {
			applyLanguage(e.data.idOfLanguage);
		}

		if(e.data.submitValue !== undefined){
			if(window.parent && !$(form).valid()) {
				parent.postMessage({ isFormValid: $(form).valid()},"*");
			}

			onSubmitHandler();
		}
	});

	form.addEventListener('submit', function(event){
		event.preventDefault();
		event.stopPropagation();

		onSubmitHandler();
	});

	function onSubmitHandler(){
		wasTryOfSubmittAtLeastOnce = true;

		if ($(form).valid()) {
			$('#validate_payment').prop('disabled', false);
		} else {
			$('#validate_payment').prop('disabled', 'disabled');

			return false;
		}

		process_data();
	}

	jQuery.validator.setDefaults({
		errorElement: 'span',
		errorPlacement: function (error, element) {
			error.addClass('invalid-feedback');

			if (element.attr("name") == "ccExpMM" || element.attr("name") == "ccExpYY") {
				$("#ccExpMM").closest('.form-group').append(error);
				$("#ccExpYY").closest('.form-group').append(error.clone());
			} else {
				element.closest('.form-group').append(error);
			}
		},
		highlight: function (element, errorClass, validClass) {
			$(element).addClass('is-invalid');
		},
		unhighlight: function (element, errorClass, validClass) {
			$(element).removeClass('is-invalid');
		},
		success : function (label, element) {
			$(element).removeClass('is-invalid');
			$(element).addClass('is-valid');
		}
	});

	$('#payment_info input, #payment_info select').on('change', function() {
		if(!wasTryOfSubmittAtLeastOnce) {
			return false;
		}

		if ($(form).valid()) {
			$('#validate_payment').prop('disabled', false);
		} else {
			$('#validate_payment').prop('disabled', 'disabled');
		}

		if(window.parent) {
			parent.postMessage({ isFormValid: $(form).valid()},"*");
		}
	});

	$(form).validate({
		rules: {
			ccName: {
				required: true,
				letterswithbasicpunc: true
			},
			ccNumber: {
				required:true,
				numberswithbasicpunc: true
			},
			ccCVC: {
				required: true,
				number:true,
			},
			ccExpMM:{
				required: true,
				CCExp:true
			},
			ccExpYY:{
				required: true,
				CCExp:true
			},
			ccZip:{
				required: true,
				number:true,
			}
		},
		groups: {
			nameGroup: "ccExpMM ccExpYY"
		}
	});

	window.addEventListener('resize', debounce(function (e) {
		sendFormHeightToParent();
	}));

	function process_data() {
		jQuery('#validate_payment').hide();
		jQuery('#loading_div').show();
		jQuery('#error_message').hide();
		clear_errors();

		if(isFormInOepFlag){
			sendFormHeightToParent();
		}

		var params = jQuery('#payment_info').serialize();

		jQuery.ajax({
			'url': '/oss/web/customercare/paymentcapture',
			'type':'post',
			'dataType':'json',
			'timeout': 60000,
			'ajax': '1',
			'data': params,
			success: function(data){
				var json = data;
				if (json.errors == 0)
				{
					jQuery('#img_ok').show();
					jQuery('#success_info').text("Information validated successfully");

					jQuery('#loading_div').hide();
					signal_parent(json);
				}
				else {
					var lu = document.createElement("ul");
					lu.setAttribute('id','errorList')
					jQuery('#error_message').append(lu)
					jQuery.each(json.detail, function(key, item){
						append_error(lu, item)
					});
					jQuery('#error_message').show();
					jQuery('#validate_payment').show();

					jQuery('#loading_div').hide();
					signal_parent(json);
				}
			},
			error: function(data)
			{
				var lu = document.createElement("ul");
				lu.setAttribute('id','errorList')
				jQuery('#error_message').append(lu)
				append_error(lu, "Internal Error Occured")
				jQuery('#error_message').show();
				jQuery('#validate_payment').show();

				jQuery('#loading_div').hide();
				signal_parent({errors:1,detail:["Internal Failure"]});
			},
			complete: function(){
				jQuery('#loading_div').hide();
			}
		});
		return false;
	}

	function append_error(parent, text){
		var li = document.createElement("li");
		li.append(document.createTextNode(text));
		parent.append(li);
	}
	function clear_errors() {
		jQuery("#errorList").remove();
	}

	function signal_parent(data){
		if(data.errors == 0){
			var data = { is_success: true, message: "Validation Passed" };

			var event = new CustomEvent('checkout-bequick-success', {detail: data});
		}
		else {
			window.scrollTo({ top: 0, behavior: 'smooth' });
			var data = { is_success: false, message: "Validation Errors",errors: data.detail };

			var event = new CustomEvent('checkout-bequick-error', {detail: data});
		}

		if(window.parent) {
			parent.postMessage({ detail: data,  formOuterHeight: jQuery(form).outerHeight() + 20},"*");
		}

		document.dispatchEvent(event);
	}

	function sendFormHeightToParent() {
		if (window.parent) {
			window.parent.postMessage({formOuterHeight: jQuery(form).outerHeight() + 20}, "*");
		}
	}

	function debounce(func){
		var timer;
		return function(event){
			if(timer) clearTimeout(timer);
			timer = setTimeout(func,400,event);
		};
	}

	var statesArr = getUSStates();
	var statesOptionsHtmlString = '<option value="" class="js-empty-option">Select State</option>';

	statesArr.forEach(function (stateObj) {
		var stateLabel = stateObj['label'];
		var stateVal = stateObj['value'];

		var preSelectedState = $('#ccState').val();

		var isSelectedOption = preSelectedState.toUpperCase() === stateVal.toUpperCase();

		var optionStartString = isSelectedOption ? '<option selected="true" value="' : '<option value="';

		statesOptionsHtmlString += optionStartString +stateVal+'">'+stateLabel+'</option>';
	});

	$('#ccStateSelect').html(statesOptionsHtmlString);

	$('#ccStateSelect').on('change', function () {
		var selectedVal = $(this).find(":selected").val()

		if(!window.stateValWasChanged){
			$('#ccState').val(selectedVal);
		} else {
			window.stateValWasChanged = false;
		}
	});

	$('#ccState').on('change', function () {
		setStateSelectVal($("#ccState").val().toUpperCase());
	});

	//if value property of hidden ccState input was changed programmatically we also need to update ccStateSelect value
	const stateInput = document.querySelector("#ccState");
	const desc = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, "value");
	Object.defineProperty(stateInput, "value", {
		get: desc.get,
		set: function(newValue) {
			window.stateValWasChanged = true;

			setStateSelectVal(newValue.toUpperCase());

			console.log("setting programmatically", newValue);
			desc.set.call(this, newValue);
		}
	});

	function setStateSelectVal(newStateVal){
		if($('#ccStateSelect option[value="'+newStateVal+'"]').length>0) {
			$('#ccStateSelect').val(newStateVal).change();
		}
	}

	function getUSStates() {
		return [
			{
				'label': 'Alabama',
				'value': 'AL',
			},
			{
				'label': 'Alaska',
				'value': 'AK',
			},
			{
				'label': 'Arizona',
				'value': 'AZ',
			},
			{
				'label': 'Arkansas',
				'value': 'AR',
			},
			{
				'label': 'California',
				'value': 'CA',
			},
			{
				'label': 'Colorado',
				'value': 'CO',
			},
			{
				'label': 'Connecticut',
				'value': 'CT',
			},
			{
				'label': 'Delaware',
				'value': 'DE',
			},
			{
				'label': 'District of Columbia',
				'value': 'DC',
			},
			{
				'label': 'Florida',
				'value': 'FL',
			},
			{
				'label': 'Georgia',
				'value': 'GA',
			},
			{
				'label': 'Hawaii',
				'value': 'HI',
			},
			{
				'label': 'Idaho',
				'value': 'ID',
			},
			{
				'label': 'Illinois',
				'value': 'IL',
			},
			{
				'label': 'Indiana',
				'value': 'IN',
			},
			{
				'label': 'Iowa',
				'value': 'IA',
			},
			{
				'label': 'Kansas',
				'value': 'KS',
			},
			{
				'label': 'Kentucky',
				'value': 'KY',
			},
			{
				'label': 'Louisiana',
				'value': 'LA',
			},
			{
				'label': 'Maine',
				'value': 'ME',
			},
			{
				'label': 'Montana',
				'value': 'MT',
			},
			{
				'label': 'Nebraska',
				'value': 'NE',
			},
			{
				'label': 'Nevada',
				'value': 'NV',
			},
			{
				'label': 'New Hampshire',
				'value': 'NH',
			},
			{
				'label': 'New Jersey',
				'value': 'NJ',
			},
			{
				'label': 'New Mexico',
				'value': 'NM',
			},
			{
				'label': 'New York',
				'value': 'NY',
			},
			{
				'label': 'North Carolina',
				'value': 'NC',
			},
			{
				'label': 'North Dakota',
				'value': 'ND',
			},
			{
				'label': 'Ohio',
				'value': 'OH',
			},
			{
				'label': 'Oklahoma',
				'value': 'OK',
			},
			{
				'label': 'Oregon',
				'value': 'OR',
			},
			{
				'label': 'Maryland',
				'value': 'MD',
			},
			{
				'label': 'Massachusetts',
				'value': 'MA',
			},
			{
				'label': 'Michigan',
				'value': 'MI',
			},
			{
				'label': 'Minnesota',
				'value': 'MN',
			},
			{
				'label': 'Mississippi',
				'value': 'MS',
			},
			{
				'label': 'Missouri',
				'value': 'MO',
			},
			{
				'label': 'Pennsylvania',
				'value': 'PA',
			},
			{
				'label': 'Puerto Rico',
				'value': 'PR',
			},
			{
				'label': 'Rhode Island',
				'value': 'RI',
			},
			{
				'label': 'South Carolina',
				'value': 'SC',
			},
			{
				'label': 'South Dakota',
				'value': 'SD',
			},
			{
				'label': 'Tennessee',
				'value': 'TN',
			},
			{
				'label': 'Texas',
				'value': 'TX',
			},
			{
				'label': 'Utah',
				'value': 'UT',
			},
			{
				'label': 'Vermont',
				'value': 'VT',
			},
			{
				'label': 'Virginia',
				'value': 'VA',
			},
			{
				"label": "U.S. Virgin Islands",
				"value": "VI"
			},
			{
				'label': 'Washington',
				'value': 'WA',
			},
			{
				'label': 'West Virginia',
				'value': 'WV',
			},
			{
				'label': 'Wisconsin',
				'value': 'WI',
			},
			{
				'label': 'Wyoming',
				'value': 'WY',
			},
		];
	}

	applyLanguage('en');
</SCRIPT>